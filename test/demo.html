<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/i/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>pQuery Test</title>
  <meta name="description" content="">

  <style>
    #wrapper {
      margin: 2em auto;
      width: 500px;
    }
    #world {
      background: #333;
    }
  </style>

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">
  <script src="easeljs-0.4.2.min.js"></script>
</head>
<body>
  
  <div id="wrapper">

    <canvas id="world" width="500" height="500"></canvas>

  </div>

  <!-- JavaScript at the bottom for fast page loading: http://developer.yahoo.com/performance/rules.html#js_bottom -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.7.2.min.js"><\/script>')</script>-->

  <script src="../lib/require.js"></script>
  <script>
  	require.config({
  		baseUrl: '../src/'
  	});
  	require(['pquery'], function(pQuery){
      
      window.jQuery && jQuery.noConflict();


      var stage, bounds;

      //check and see if the canvas element is supported in
      //the current browser
      //http://diveintohtml5.org/detect.html#canvas
      if(!(!!document.createElement('canvas').getContext))
      {
        var wrapper = document.getElementById("wrapper");
        wrapper.innerHTML = "Your browser does not appear to support " +
        "the HTML5 Canvas element";
        return;
      }

      //get a reference to the canvas element
      var canvas = document.getElementById("world");
 
      //copy the canvas bounds to the bounds instance.
      //Note, if we resize the canvas, we need to reset
      //these bounds.
      bounds = new Rectangle();
      bounds.width = canvas.width;
      bounds.height = canvas.height;

      //pass the canvas element to the EaselJS Stage instance
      //The Stage class abstracts away the Canvas element and
      //is the root level display container for display elements.
      stage = new Stage(canvas);
 
      //Create an EaselJS Graphics element to create the
      //commands to draw a circle
      var g = new Graphics();

      //stroke of 1 px
      g.setStrokeStyle(1);
 
      //Set the stroke color, using the EaselJS 
      //Graphics.getRGB static method.
      //This creates a white color, with an alpha
      //of .7
      g.beginStroke(Graphics.getRGB(255,255,255,.7));
 
      //draw the circle
      g.drawCircle(0,0, 10);

      //note that the circle has not been drawn yet. 
      //the Graphics instance just has the commands to
      //draw the circle.
      //It will be drawn when the stage needs to render it
      //which is usually when we call stage.tick()
 
      //create a new Shape instance. This is a DisplayObject
      //which can be added directly to the stage (and rendered).
      //Pass in the Graphics instance that we created, and that
      //we want the Shape to draw.
      circle = new Shape(g);
 
      //set the initial x position, and the reset position
      circle.x = canvas.width / 2;
 
      //set the y position
      circle.y = canvas.height / 2;
 
      //add the circle to the stage.
      stage.addChild(circle);
 
      //tell the stage to render to the canvas
      stage.update();


      var world = pQuery('world').on('step', function(){

        world.find('sphere').each(function(){

          var self = pQuery(this)
            ,view = self.data('view')
            ,pos
            ;

          if (view){

            pos = self.position();
            view.x = pos.x;
            view.y = pos.y;

          }

        });

        stage.update();

      });

      var Pcircle = pQuery('<sphere>').data('view', circle).appendTo( world );

      pQuery.ticker.subscribe(function(time, delta){

        world.step(1/180, time);

      });

      pQuery.ticker.start();

  	});
  </script>
  <!-- end scripts -->

</body>
</html>